version: "3.8"

# Docker Compose with JDBC-supported databases for testing.
# Databases included: MySQL, PostgreSQL, SQL Server
# Each is configured with and without password authentication where possible.

services:

  # ============================================================
  # PostgreSQL - with password
  # docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres
  # JDBC: jdbc:postgresql://testuser:mysecretpassword@postgres-auth:5432/testdb
  # ============================================================
  postgres-auth:
    image: postgres:16
    container_name: postgres-auth
    environment:
      POSTGRES_PASSWORD: mysecretpassword
      POSTGRES_DB: testdb
    ports:
      - "5432:5432"

  # ============================================================
  # PostgreSQL - without password (trust authentication)
  # JDBC: jdbc:postgresql://postgres@postgres-noauth:5433/testdb
  # ============================================================
  postgres-noauth:
    image: postgres:16
    container_name: postgres-noauth
    environment:
      POSTGRES_HOST_AUTH_METHOD: trust
      POSTGRES_DB: testdb
    ports:
      - "5433:5432"

  # ============================================================
  # MySQL - with password
  # docker run --name mysql-name -e MYSQL_USER=username -e MYSQL_PASSWORD=password -e MYSQL_ROOT_PASSWORD=rootpassword -d mysql
  # JDBC: jdbc:mysql://username:password@mysql-auth:3306/testdb
  # ============================================================
  mysql-auth:
    image: mysql:8.0
    container_name: mysql-auth
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: testdb
      MYSQL_USER: username
      MYSQL_PASSWORD: password
    ports:
      - "3306:3306"

  # ============================================================
  # MySQL - without password (allow empty root password)
  # JDBC: jdbc:mysql://root@mysql-noauth:3307/testdb
  # ============================================================
  mysql-noauth:
    image: mysql:8.0
    container_name: mysql-noauth
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
      MYSQL_DATABASE: testdb
      MYSQL_USER: username
    ports:
      - "3307:3306"

  # ============================================================
  # SQL Server - with password
  # docker run --name sqlserver-auth -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=YourStr0ngP@ss" -p 1433:1433 -d mcr.microsoft.com/mssql/server:2022-latest
  # JDBC: jdbc:sqlserver://sqlserver-auth:1433;user=sa;password=YourStr0ngP@ss
  # ============================================================
  sqlserver-auth:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver-auth
    environment:
      ACCEPT_EULA: "Y"
      MSSQL_SA_PASSWORD: "YourStr0ngP@ss"
    ports:
      - "1433:1433"
